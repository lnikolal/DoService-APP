
-- MySQL Script generated by MySQL Workbench
-- Complete DDL + DML with dummy data

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema do_service_db
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `do_service_test_db`DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ; 
USE `do_service_test_db` ;

-- -----------------------------------------------------
-- Table `position`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `position` (
  `position_id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`position_id`)
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `location`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `location` (
  `location_id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`location_id`)
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `specialization`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `specialization` (
  `specialization_id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`specialization_id`)
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `technician`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `technician` (
  `technician_id` INT NOT NULL AUTO_INCREMENT,
  `first_name` VARCHAR(50) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `last_name` VARCHAR(50) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `email` VARCHAR(100) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `phone` VARCHAR(50) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `status` ENUM('ACTIVE', 'INACTIVE') COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `specialization_id` INT NOT NULL,
  `location_id` INT NOT NULL,
  `employment_date` DATETIME NOT NULL,
  `profile_image_url` VARCHAR(255) COLLATE 'utf8mb3_unicode_ci' NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  `user_id` INT NOT NULL,
  PRIMARY KEY (`technician_id`),
  INDEX `idx_technician_specialization` (`specialization_id` ASC) VISIBLE,
  INDEX `idx_technician_location` (`location_id` ASC) VISIBLE,
  CONSTRAINT `fk_technician_location`
    FOREIGN KEY (`location_id`)
    REFERENCES `location` (`location_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `fk_technician_specialization`
    FOREIGN KEY (`specialization_id`)
    REFERENCES `specialization` (`specialization_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `position`, `location`, `specialization` dummy data
-- -----------------------------------------------------
INSERT INTO `position` (`name`) VALUES
('Električar'), ('Vodoinstalater'), ('Stolar'), ('Serviser klima'), ('IT tehničar'),
('Moler'), ('Zavarivač'), ('Automehaničar'), ('Elektroničar'), ('Građevinski radnik');

INSERT INTO `location` (`name`) VALUES
('Beograd'), ('Novi Sad'), ('Niš'), ('Kragujevac'), ('Subotica'),
('Zrenjanin'), ('Pančevo'), ('Čačak'), ('Kraljevo'), ('Smederevo');

INSERT INTO `specialization` (`name`) VALUES
('Instalacije'), ('Popravka'), ('Održavanje'), ('Softver'), ('Elektronika'),
('Građevina'), ('Voda'), ('Vazduh'), ('Energetika'), ('Automobili');

-- -----------------------------------------------------
-- Table `technician` dummy data
-- -----------------------------------------------------
INSERT INTO `technician` (`first_name`, `last_name`, `email`, `phone`, `status`, `specialization_id`, `location_id`, `employment_date`, `profile_image_url`,`user_id`)
VALUES
('Milan', 'Petrović', 'milan.petrovic@example.com', '0601234561', 'ACTIVE', 1, 1, '2021-01-15 08:00:00', NULL,1),
('Marko', 'Jovanović', 'marko.jovanovic@example.com', '0601234562', 'ACTIVE', 2, 2, '2022-03-10 09:30:00', NULL,2),
('Ana', 'Ilić', 'ana.ilic@example.com', '0601234563', 'INACTIVE', 3, 3, '2020-06-22 12:15:00', NULL,3),
('Jelena', 'Nikolić', 'jelena.nikolic@example.com', '0601234564', 'ACTIVE', 4, 4, '2019-11-03 07:45:00', NULL,4),
('Nikola', 'Popović', 'nikola.popovic@example.com', '0601234565', 'ACTIVE', 5, 5, '2023-05-01 10:00:00', NULL,5),
('Ivana', 'Stojanović', 'ivana.stojanovic@example.com', '0601234566', 'INACTIVE', 6, 6, '2021-07-19 15:30:00', NULL,6),
('Petar', 'Milinković', 'petar.milinkovic@example.com', '0601234567', 'ACTIVE', 7, 7, '2022-09-25 11:20:00', NULL,7),
('Goran', 'Simić', 'goran.simic@example.com', '0601234568', 'ACTIVE', 8, 8, '2020-12-31 16:40:00', NULL,8),
('Sandra', 'Janković', 'sandra.jankovic@example.com', '0601234569', 'INACTIVE', 9, 9, '2022-02-15 13:10:00', NULL,9),
('Vladimir', 'Kovačević', 'vladimir.kovacevic@example.com', '0601234570', 'ACTIVE', 10, 10, '2023-04-12 17:50:00', NULL,10);

-- -----------------------------------------------------
-- Table `contract`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `contract` (
  `contract_id` INT NOT NULL AUTO_INCREMENT,
  `technician_id` INT NOT NULL,
  `position_id` INT NOT NULL,
  `salary` DECIMAL(10,2) NOT NULL,
  `start_date` DATE NOT NULL,
  `end_date` DATE NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`contract_id`),
  INDEX `idx_contract_technician` (`technician_id` ASC) VISIBLE,
  INDEX `idx_contract_position` (`position_id` ASC) VISIBLE,
  CONSTRAINT `fk_contract_position`
    FOREIGN KEY (`position_id`)
    REFERENCES `position` (`position_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `fk_contract_technician`
    FOREIGN KEY (`technician_id`)
    REFERENCES `technician` (`technician_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `contract` dummy data
-- -----------------------------------------------------
INSERT INTO `contract` (`technician_id`, `position_id`, `salary`, `start_date`, `end_date`)
VALUES
(1, 1, 65000, '2022-01-01', NULL),
(2, 2, 60000, '2022-02-01', '2023-02-01'),
(3, 3, 55000, '2021-06-01', NULL),
(4, 4, 70000, '2020-07-15', '2022-07-15'),
(5, 5, 80000, '2023-05-01', NULL),
(6, 6, 60000, '2021-09-10', NULL),
(7, 7, 50000, '2022-10-20', NULL),
(8, 8, 62000, '2020-12-31', NULL),
(9, 9, 58000, '2022-03-01', NULL),
(10, 10, 90000, '2023-04-12', NULL);

-- -----------------------------------------------------
-- Table `contract_file`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `contract_file` (
  `contract_file_id` INT NOT NULL AUTO_INCREMENT,
  `contract_id` INT NOT NULL,
  `file_url` VARCHAR(255) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`contract_file_id`),
  INDEX `idx_cf_contract` (`contract_id` ASC) VISIBLE,
  CONSTRAINT `fk_contract_file_contract`
    FOREIGN KEY (`contract_id`)
    REFERENCES `contract` (`contract_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `contract_file` dummy data
-- -----------------------------------------------------
INSERT INTO `contract_file` (`contract_id`, `file_url`)
VALUES
(1, 'uploads/1.pdf'),
(2, 'uploads/1.pdf'),
(3, 'uploads/1.pdf'),
(4, 'uploads/1.pdf'),
(5, 'uploads/1.pdf'),
(6, 'uploads/1.pdf'),
(7, 'uploads/1.pdf'),
(8, 'uploads/1.pdf'),
(9, 'uploads/1.pdf'),
(10, 'uploads/1.pdf');

-- -----------------------------------------------------
-- Table `role`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `role` (
  `role_id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(50) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`role_id`)
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `role` dummy data
-- -----------------------------------------------------
INSERT INTO `role` (`role_id`, `name`) VALUES
(1, 'ADMIN'),
(2, 'TECHNICIAN'),
(3, 'MANAGER');

-- -----------------------------------------------------
-- Table `service_type`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `service_type` (
  `service_type_id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`service_type_id`)
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `service_type` dummy data
-- -----------------------------------------------------
INSERT INTO `service_type` (`name`)
VALUES
('Montaža'), ('Popravka'), ('Održavanje'), ('Servis klima uređaja'), ('Softverska instalacija'),
('Električne instalacije'), ('Građevinski radovi'), ('Sanacija vode'), ('Auto servis'), ('IT podrška');

-- -----------------------------------------------------
-- Table `task_status`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `task_status` (
  `task_status_id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(50) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`task_status_id`)
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `task_status` dummy data (po tvojoj poslednjoj instrukciji)
-- -----------------------------------------------------
INSERT INTO `task_status` (`name`)
VALUES
('PENDING'),
('COMPLETED'),
('CANCELLED'),
('IN PROGRESS');

-- -----------------------------------------------------
-- Table `task`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `task` (
  `task_id` INT NOT NULL AUTO_INCREMENT,
  `service_type_id` INT NOT NULL,
  `client_name` VARCHAR(100) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `client_contact` VARCHAR(100) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `client_address` VARCHAR(255) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `task_status_id` INT NOT NULL,
  `assigned_date` DATETIME NOT NULL,
  `completion_date` DATETIME NULL DEFAULT NULL,
  `description` TEXT COLLATE 'utf8mb3_unicode_ci' NULL DEFAULT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`task_id`),
  INDEX `idx_task_service_type` (`service_type_id` ASC) VISIBLE,
  INDEX `idx_task_status` (`task_status_id` ASC) VISIBLE,
  CONSTRAINT `fk_task_service_type`
    FOREIGN KEY (`service_type_id`)
    REFERENCES `service_type` (`service_type_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `fk_task_status`
    FOREIGN KEY (`task_status_id`)
    REFERENCES `task_status` (`task_status_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `task` dummy data
-- -----------------------------------------------------
INSERT INTO `task` (`service_type_id`, `client_name`, `client_contact`, `client_address`, `task_status_id`, `assigned_date`, `completion_date`, `description`)
VALUES
(1, 'Firma ABC', '011/234-5678', 'Kralja Petra 1, Beograd', 1, '2024-05-10 09:00:00', NULL, 'Montaža opreme u kancelariji'),
(2, 'Ivan Petrov', '060/123-4567', 'Bulevar oslobođenja 45, Novi Sad', 2, '2024-05-12 10:00:00', '2024-05-12 17:00:00', 'Popravka bojlera'),
(3, 'Jelena Marković', '064/987-6543', 'Ulica Branka Radičevića 7, Niš', 3, '2024-06-01 08:30:00', '2024-06-01 13:00:00', 'Redovno održavanje'),
(4, 'Dragan Lukić', '063/333-2222', 'Milutina Milankovića 25, Kragujevac', 4, '2024-06-05 13:15:00', NULL, 'Servis klima uređaja'),
(5, 'Marija Jovanović', '062/222-3333', 'Zmaj Jovina 2, Subotica', 1, '2024-06-10 12:00:00', NULL, 'Softverska instalacija'),
(6, 'Nenad Đorđević', '061/444-5555', 'Kralja Milana 13, Pančevo', 2, '2024-06-12 14:00:00', NULL, 'Električne instalacije'),
(7, 'Tatjana Savić', '065/111-2222', 'Nemanjina 19, Čačak', 3, '2024-06-15 09:30:00', NULL, 'Građevinski radovi'),
(8, 'Milan Todorović', '066/333-4444', 'Obilićeva 14, Kraljevo', 4, '2024-06-17 10:20:00', NULL, 'Sanacija vode'),
(9, 'Zoran Pantić', '067/555-6666', 'Gospodar Jevremova 33, Smederevo', 1, '2024-06-20 08:00:00', NULL, 'Auto servis'),
(10, 'Vesna Ristić', '068/777-8888', 'Balkanska 1, Beograd', 2, '2024-06-22 11:10:00', NULL, 'IT podrška na terenu');

-- -----------------------------------------------------
-- Table `task_file`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `task_file` (
  `task_file_id` INT NOT NULL AUTO_INCREMENT,
  `task_id` INT NOT NULL,
  `file_url` VARCHAR(255) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`task_file_id`),
  INDEX `idx_tf_task` (`task_id` ASC) VISIBLE,
  CONSTRAINT `fk_task_file_task`
    FOREIGN KEY (`task_id`)
    REFERENCES `task` (`task_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `task_file` dummy data
-- -----------------------------------------------------
INSERT INTO `task_file` (`task_id`, `file_url`)
VALUES
(1, 'tasks/1-file1.pdf'),
(2, 'tasks/2-file2.pdf'),
(3, 'tasks/3-file3.pdf'),
(4, 'tasks/4-file4.pdf'),
(5, 'tasks/5-file5.pdf'),
(6, 'tasks/6-file6.pdf'),
(7, 'tasks/7-file7.pdf'),
(8, 'tasks/8-file8.pdf'),
(9, 'tasks/9-file9.pdf'),
(10, 'tasks/10-file10.pdf');

-- -----------------------------------------------------
-- Table `task_technician`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `task_technician` (
  `task_id` INT NOT NULL,
  `technician_id` INT NOT NULL,
  PRIMARY KEY (`task_id`, `technician_id`),
  INDEX `idx_tt_task` (`task_id` ASC) VISIBLE,
  INDEX `idx_tt_technician` (`technician_id` ASC) VISIBLE,
  CONSTRAINT `fk_tt_task`
    FOREIGN KEY (`task_id`)
    REFERENCES `task` (`task_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `fk_tt_technician`
    FOREIGN KEY (`technician_id`)
    REFERENCES `technician` (`technician_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `task_technician` dummy data (više tehničara po tasku)
-- -----------------------------------------------------
INSERT INTO `task_technician` (`task_id`, `technician_id`)
VALUES
(1, 1), (1, 2),
(2, 2), (2, 3), (2, 4),
(3, 3), (3, 4), (3, 5),
(4, 4), (4, 5),
(5, 5), (5, 6), (5, 7),
(6, 6), (6, 7),
(7, 7), (7, 8), (7, 9),
(8, 8), (8, 9), (8, 10),
(9, 9), (9, 10),
(10, 10), (10, 1), (10, 2);

-- -----------------------------------------------------
-- Table `user`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `user` (
  `user_id` INT NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(50) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `email` VARCHAR(100) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `password_hash` VARCHAR(255) COLLATE 'utf8mb3_unicode_ci' NOT NULL,
  `role_id` INT NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` TIMESTAMP NULL DEFAULT NULL,
  PRIMARY KEY (`user_id`),
  INDEX `idx_user_role` (`role_id` ASC) VISIBLE,
  CONSTRAINT `fk_user_role`
    FOREIGN KEY (`role_id`)
    REFERENCES `role` (`role_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
) ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `user` dummy data
-- -----------------------------------------------------
INSERT INTO `user` (`username`, `email`, `password_hash`, `role_id`)
VALUES
('admin', 'admin@doservice.com', 'hash_admin', 1),
('manager', 'manager@doservice.com', 'hash_manager', 3),
('milan.p', 'milan.petrovic@example.com', 'hash1', 2),
('marko.j', 'marko.jovanovic@example.com', 'hash2', 2),
('ana.i', 'ana.ilic@example.com', 'hash3', 2),
('jelena.n', 'jelena.nikolic@example.com', 'hash4', 2),
('nikola.p', 'nikola.popovic@example.com', 'hash5', 2),
('ivana.s', 'ivana.stojanovic@example.com', 'hash6', 2),
('petar.m', 'petar.milinkovic@example.com', 'hash7', 2),
('goran.s', 'goran.simic@example.com', 'hash8', 2),
('sandra.j', 'sandra.jankovic@example.com', 'hash9', 2),
('vladimir.k', 'vladimir.kovacevic@example.com', 'hash10', 2);

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
